---
title: "Multiplicity graphs"
output: rmarkdown::html_vignette
bibliography: gsDesign.bib
vignette: >
  %\VignetteIndexEntry{Multiplicity graphs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction

```{r setup}
library(gsDesign)
library(testthat)### REMOVE THIS BEFORE BUILD
library(dplyr)
source("C:/Users/anderkea/Documents/BackItUp/gsDesignDev/hGraph.r")
```

With version 3.1, we have added a functions to support graphical multiplicity methods.
This is introduced nicely in @Bretz2011 and supported by the ***gMCP*** package (@gMCP).
It was extended to group sequential design by @MaurerBretz2013.
While the ***gMCP*** 
package supports graphics, here we add the `hGraph()` function to create multiplicity graphs using the ***ggplot2*** package.
We demonstrate basic use, including with group sequential design in this article.
While the simple cases presented here can be dealt with without the **heavy artillery** presented here, more complex cases have easily been dealt with using these tools.


# Introducing basic arguments

## Hypotheses, weights, colors and legends

We begin with the default plot;
on non-Windows systems, the default character $\alpha$ in the plot is replaced by w.
Some basic design features are:

- Hypotheses are stated in filled ellipses along with corresponding weights or $\alpha$-levels assigned.
- Default positioning of hypotheses is sequential in radians on an elliptical path; thus, the default ordering of H1, H2, H3, H4 below.
    - One advantage of this is that generally transition lines between hypotheses will not cross hypothesis ellipses, including when the graph is updated when some hypotheses are rejected.
    - The user can override this by stating $x$ and $y$ coordinates for hypotheses.
- Legends and colors or shading are easily incorporated.
- The ***gMCP*** package is easily applied to evaluate rejection of hypotheses.
- With the `gsDesign::sequentialPvalue()` function, group sequential testing is enabled as in @MaurerBretz2013.
@MaurerBretz2013 is easily incorporated.



```{r,fig.width=7.5,fig.height=4}
hGraph(digits = 5, fill=c(1,1,2,3))
```

Next, we add a legend, custom colors, rename hypotheses, and customize hypothesis placement.
We also set the character for weights to `w` and have weights sum to 1 rather than $\alpha=0.025$.
Most common options for `legend.placement` would be "top", "bottom", "right", "left". 
Note that the specifying the x, y coordinates with 'legend.position = c(.75, .25)' as here uses x and y as values in the range [0, 1] as the scales are relative to the plot window.

```{r,fig.width=7.5,fig.height=4}
hGraph(nHypotheses = 3,
       nameHypotheses = LETTERS[1:3],
       alphaHypotheses = c(.2,.3,.5),
       wchar='w',
       size=8,
       x = c(0, 1, 0)*2,
       y = c(1, 1, 0)*2,
       fill = as.factor(c(1,1,2)),
       palette = c("yellow", "lightblue"),
       legend.name = "Importance",
       labels = c("Primary", "Secondary"),
       legend.position = c(.75,.25)
)
```

## Transition weights

```{r,fig.width=7.5,fig.height=4}
hGraph(nHypotheses = 5, 
       m = matrix(c(0, 1, 0, 0, 0,
                    0, 0, 1, 0, 0,
                    0, 0, 0, .4, .6,
                    0, 0, 0, 0, 1,
                    1, 0, 0, 0 ,0),
                  nrow=5, byrow=TRUE),
       trprop = .2, trhh=.13, trhw = 0.15, trdigits = 3,
       boxtextsize = 5, arrowsize = .03, offset = 0)
```

## Evaluating a multiplicity graph


## Color palette and legends

```{r,fig.width=7.5,fig.height=4}
# Colorblind palette
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73",
               "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
hGraph(nHypotheses = 3,
       nameHypotheses = LETTERS[1:3],
       alphaHypotheses = c(.2,.3,.5),
       fill = as.factor(c(1,1,2)),
       palette = cbPalette[2:3],
       legend.name = "Legend: ",
       labels = c("High","Low"),
       legend.position = "right",
       wchar = 'w'
) 
```


# References
